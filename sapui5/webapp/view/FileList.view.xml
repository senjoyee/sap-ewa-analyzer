<mvc:View
    controllerName="ewa.analyzer.controller.FileList"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:u="sap.ui.unified"
    xmlns:l="sap.ui.layout"
    xmlns:f="sap.f"
    xmlns:core="sap.ui.core"
    core:require="{
        DateType: 'sap/ui/model/type/Date'
    }">
    <Page title="{i18n>fileListTitle}" backgroundDesign="List">
        <content>
            <!-- Grey Background Container -->
            <!-- White Centered Content -->
            <VBox class="paperSheet fileListSheet sapUiSizeCompact">
            <!-- Upload Area -->
            <Panel
                headerText="{i18n>uploadTitle}"
                expandable="true"
                expanded="{uploadPanel>/expanded}"
                class="uploadPanel"
                width="auto">
                    <content>
                        <VBox class="uploadArea">
                            <HBox justifyContent="SpaceBetween" alignItems="Center" wrap="Wrap" width="100%" class="sapUiTinyMarginBottom">
                                <u:FileUploader
                                    id="fileUploader"
                                    name="file"
                                    multiple="true"
                                    tooltip="Upload your file to the local server"
                                    uploadComplete=".onUploadComplete"
                                    change=".onFileChange"
                                    typeMissmatch=".handleTypeMissmatch"
                                    style="Emphasized"
                                    fileType="pdf"
                                    width="22rem"
                                    placeholder="Choose PDF file..."
                                    class="sapUiSmallMarginEnd"/>
                                <Button text="{i18n>uploadButton}" type="Emphasized" press=".onUploadPress" icon="sap-icon://upload"/>
                            </HBox>
                            <Table
                                id="uploadQueueTable"
                                items="{uploadQueue>/files}"
                                visible="{= ${uploadQueue>/files}.length > 0 }"
                                width="100%">
                                <headerToolbar>
                                    <OverflowToolbar class="uploadQueueToolbar" design="Transparent">
                                        <Title text="Selected files (set customer per file)" level="H3"/>
                                    </OverflowToolbar>
                                </headerToolbar>
                                <columns>
                                    <Column>
                                        <Text text="File"/>
                                    </Column>
                                    <Column hAlign="End">
                                        <Text text="Size (bytes)"/>
                                    </Column>
                                    <Column hAlign="Begin">
                                        <Text text="Customer"/>
                                    </Column>
                                </columns>
                                <items>
                                    <ColumnListItem vAlign="Middle">
                                        <cells>
                                            <ObjectIdentifier title="{uploadQueue>name}"/>
                                            <Text text="{uploadQueue>size}"/>
                                            <Select
                                                selectedKey="{uploadQueue>customer}"
                                                change=".onUploadQueueCustomerChange"
                                                width="200px"
                                                forceSelection="true"
                                                items="{customers>/customers}">
                                                <core:Item key="" text="Select customer"/>
                                                <core:Item key="{customers>key}" text="{customers>text}"/>
                                            </Select>
                                        </cells>
                                    </ColumnListItem>
                                </items>
                            </Table>
                        </VBox>
                    </content>
                </Panel>

                <!-- File List Table -->
                <Table
                    id="filesTable"
                    class="sapUiSmallMarginTop"
                    items="{
                        path: 'files>/',
                        sorter: [{
                            path: 'customer',
                            group: true
                        }]
                    }"
                    groupHeaderFactory=".createCustomerGroupHeader"
                    mode="MultiSelect"
                    growing="true"
                    growingThreshold="20"
                    width="100%"
                    sticky="HeaderToolbar,ColumnHeaders"
                    selectionChange=".onSelectionChange">
                    <headerToolbar>
                        <OverflowToolbar class="fileListToolbar" design="Transparent">
                            <Title text="Files ({= ${files>/}.length })" level="H2"/>
                            <ToolbarSpacer/>
                            <Label text="Filter:" labelFor="customerFilter" class="sapUiTinyMarginEnd"/>
                            <Select
                                id="customerFilter"
                                forceSelection="true"
                                change=".onCustomerFilterChange"
                                items="{customers>/customers}"
                                selectedKey="{view>/selectedCustomer}"
                                width="200px"
                                class="sapUiSmallMarginEnd">
                                <core:Item key="{customers>key}" text="{customers>text}"/>
                            </Select>
                            <ToolbarSeparator/>
                            <Button text="{i18n>process}" icon="sap-icon://activate" press=".onBatchProcessPress" type="Accept" enabled="{= ${selectedFiles>/count} > 0 }"/>
                            <Button text="{i18n>delete}" press=".onBatchDeletePress" type="Reject" icon="sap-icon://delete" enabled="{= ${selectedFiles>/count} > 0 }"/>
                            <Button icon="sap-icon://refresh" tooltip="Refresh" type="Transparent" press=".onRefreshFiles"/>
                        </OverflowToolbar>
                    </headerToolbar>
                    <columns>
                        <Column>
                            <Text text="{i18n>fileName}"/>
                        </Column>
                        <Column minScreenWidth="Tablet" demandPopin="true">
                            <Text text="{i18n>status}"/>
                        </Column>
                        <Column minScreenWidth="Desktop" demandPopin="true" hAlign="End">
                            <Text text="{i18n>uploadDate}"/>
                        </Column>
                        <Column minScreenWidth="Desktop" demandPopin="true" hAlign="End">
                            <Text text="{i18n>reportDate}"/>
                        </Column>
                        <Column hAlign="End">
                            <Text text="{i18n>actions}"/>
                        </Column>
                    </columns>
                    <items>
                        <ColumnListItem vAlign="Middle">
                            <cells>
                                <ObjectIdentifier title="{files>name}"/>
                                <ObjectStatus
                                    text="{files>status}"
                                    inverted="true"
                                    state="{path: 'files>status', formatter: '.formatter.statusState'}"
                                    icon="{path: 'files>status', formatter: '.formatter.statusIcon'}"/>
                                <Text text="{path: 'files>uploadDate', type: 'DateType', formatOptions: { style: 'medium' }}"/>
                                <Text text="{path: 'files>reportDate', type: 'DateType', formatOptions: { style: 'medium' }}"/>
                                <HBox
                                    class="actionsContainer"
                                    height="100%"
                                    justifyContent="End"
                                    alignItems="Center"
                                    visible="{= ${files>status} ? ${files>status}.toLowerCase() !== 'processing' : true }">
                                    <Button
                                        text="{i18n>viewAnalysis}"
                                        icon="sap-icon://show"
                                        type="Transparent"
                                        press=".onViewAnalysisPress"
                                        visible="false"/>
                                    <Button
                                        tooltip="{i18n>chatTitle}"
                                        icon="sap-icon://response"
                                        type="Transparent"
                                        press=".onChatPress"
                                        class="sapUiTinyMarginBegin"
                                        visible="{= ${files>status} === 'Analyzed' || ${files>status} === 'completed' }"/>
                                    <Button
                                        tooltip="Download PDF Report"
                                        icon="sap-icon://pdf-attachment"
                                        type="Transparent"
                                        press=".onDownloadPress"
                                        class="sapUiTinyMarginBegin"
                                        visible="{= ${files>status} === 'Analyzed' || ${files>status} === 'completed' }"/>
                                    <Button
                                        tooltip="Download Excel Report"
                                        icon="sap-icon://excel-attachment"
                                        type="Transparent"
                                        press=".onDownloadExcelPress"
                                        class="sapUiTinyMarginBegin"
                                        visible="{= ${files>status} === 'Analyzed' || ${files>status} === 'completed' }"/>
                                    <Button
                                        tooltip="{i18n>process}"
                                        icon="sap-icon://activate"
                                        type="Transparent"
                                        press=".onProcessPress"
                                        class="sapUiTinyMarginBegin"
                                        visible="{= ${files>status} ? ${files>status}.toLowerCase() !== 'processed' &amp;&amp; ${files>status}.toLowerCase() !== 'analyzed' &amp;&amp; ${files>status}.toLowerCase() !== 'completed' &amp;&amp; ${files>status}.toLowerCase() !== 'processing' : true }"/>
                                </HBox>
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>
            </VBox>
        </content>
    </Page>
</mvc:View>
