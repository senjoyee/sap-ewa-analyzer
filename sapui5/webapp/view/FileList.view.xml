<mvc:View
    controllerName="ewa.analyzer.controller.FileList"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:u="sap.ui.unified"
    xmlns:l="sap.ui.layout"
    xmlns:f="sap.f"
    xmlns:core="sap.ui.core">
    <Page title="{i18n>fileListTitle}">
        <content>
            <!-- Grey Background Container -->
            <ScrollContainer height="100%" width="100%" vertical="true" horizontal="false" class="appBackground">
                <!-- White Centered Content -->
                <VBox class="paperSheet fileListSheet">
                <!-- Upload Area -->
                <Panel
                    headerText="{i18n>uploadTitle}"
                    expandable="true"
                    expanded="{uploadPanel>/expanded}"
                    width="auto">
                    <content>
                        <VBox class="uploadArea">
                            <HBox justifyContent="Center" alignItems="Center" wrap="Wrap">
                                <Select id="customerSelect" width="300px" class="sapUiSmallMarginEnd" forceSelection="true">
                                    <items>
                                        <core:Item key="" text="Select customer"/>
                                        <core:Item key="TBS" text="TBS"/>
                                        <core:Item key="BSW" text="BSW"/>
                                        <core:Item key="SHOOSMITHS" text="SHOOSMITHS"/>
                                        <core:Item key="COREX" text="COREX"/>
                                        <core:Item key="SONOCO" text="SONOCO"/>
                                        <core:Item key="ASAHI" text="ASAHI"/>
                                    </items>
                                </Select>
                                <u:FileUploader
                                    id="fileUploader"
                                    name="file"
                                    multiple="true"
                                    tooltip="Upload your file to the local server"
                                    uploadComplete="onUploadComplete"
                                    change="onFileChange"
                                    typeMissmatch="handleTypeMissmatch"
                                    style="Emphasized"
                                    fileType="pdf"
                                    placeholder="Choose PDF file..."
                                    class="sapUiSmallMarginEnd"/>
                                <Button text="{i18n>uploadButton}" type="Emphasized" press="onUploadPress" icon="sap-icon://upload"/>
                            </HBox>
                            <Table
                                id="uploadQueueTable"
                                items="{uploadQueue>/files}"
                                visible="{= ${uploadQueue>/files}.length > 0 }"
                                width="auto">
                                <headerToolbar>
                                    <OverflowToolbar>
                                        <Title text="Selected files (set customer per file)" level="H3"/>
                                    </OverflowToolbar>
                                </headerToolbar>
                                <columns>
                                    <Column>
                                        <Text text="File"/>
                                    </Column>
                                    <Column hAlign="End">
                                        <Text text="Size (bytes)"/>
                                    </Column>
                                    <Column hAlign="Begin">
                                        <Text text="Customer"/>
                                    </Column>
                                </columns>
                                <items>
                                    <ColumnListItem vAlign="Middle">
                                        <cells>
                                            <ObjectIdentifier title="{uploadQueue>name}"/>
                                            <Text text="{uploadQueue>size}"/>
                                            <Select
                                                selectedKey="{uploadQueue>customer}"
                                                change=".onUploadQueueCustomerChange"
                                                width="200px"
                                                forceSelection="true"
                                                items="{customers>/customers}">
                                                <core:Item key="" text="Select customer"/>
                                                <core:Item key="{customers>key}" text="{customers>text}"/>
                                            </Select>
                                        </cells>
                                    </ColumnListItem>
                                </items>
                            </Table>
                        </VBox>
                    </content>
                </Panel>

                <!-- File List Table -->
                <Table
                    id="filesTable"
                    class="sapUiMediumMarginTop"
                    items="{
                        path: 'files>/',
                        sorter: [{
                            path: 'customer',
                            group: true
                        }]
                    }"
                    groupHeaderFactory=".createCustomerGroupHeader"
                    mode="MultiSelect"
                    growing="true"
                    growingThreshold="20"
                    width="auto"
                    selectionChange="onSelectionChange">
                    <headerToolbar>
                        <OverflowToolbar>
                            <Title text="Files ({= ${files>/}.length })" level="H2"/>
                            <ToolbarSpacer/>
                            <Button text="{i18n>process}" press="onBatchProcessPress" type="Accept" enabled="{= ${selectedFiles>/count} > 0 }"/>
                            <Button text="{i18n>delete}" press="onBatchDeletePress" type="Reject" icon="sap-icon://delete" enabled="{= ${selectedFiles>/count} > 0 }"/>
                            <Button icon="sap-icon://refresh" press="onRefreshFiles"/>
                        </OverflowToolbar>
                    </headerToolbar>
                    <columns>
                        <Column>
                            <Text text="{i18n>fileName}"/>
                        </Column>
                        <Column minScreenWidth="Tablet" demandPopin="true">
                            <Text text="{i18n>status}"/>
                        </Column>
                        <Column minScreenWidth="Desktop" demandPopin="true" hAlign="End">
                            <Text text="{i18n>uploadDate}"/>
                        </Column>
                        <Column minScreenWidth="Desktop" demandPopin="true" hAlign="End">
                            <Text text="{i18n>reportDate}"/>
                        </Column>
                        <Column hAlign="End">
                            <Text text="{i18n>actions}"/>
                        </Column>
                    </columns>
                    <items>
                        <ColumnListItem vAlign="Middle">
                            <cells>
                                <ObjectIdentifier title="{files>name}"/>
                                <ObjectStatus
                                    text="{files>status}"
                                    state="{path: 'files>status', formatter: '.formatter.statusState'}"
                                    icon="{path: 'files>status', formatter: '.formatter.statusIcon'}"/>
                                <Text text="{path: 'files>uploadDate', type: 'sap.ui.model.type.Date', formatOptions: { style: 'medium' }}"/>
                                <Text text="{path: 'files>reportDate', type: 'sap.ui.model.type.Date', formatOptions: { style: 'medium' }}"/>
                                <HBox
                                    class="actionsContainer"
                                    height="100%"
                                    justifyContent="End"
                                    alignItems="Center"
                                    visible="{= ${files>status} ? ${files>status}.toLowerCase() !== 'processing' : true }">
                                    <Button
                                        text="{i18n>viewAnalysis}"
                                        icon="sap-icon://show"
                                        type="Transparent"
                                        press=".onViewAnalysisPress"
                                        visible="{= ${files>status} === 'Analyzed' || ${files>status} === 'completed' }"/>
                                    <Button
                                        tooltip="Download PDF Report"
                                        icon="sap-icon://download"
                                        type="Transparent"
                                        press=".onDownloadPress"
                                        visible="{= ${files>status} === 'Analyzed' || ${files>status} === 'completed' }"/>
                                    <Button
                                        text="{i18n>process}"
                                        icon="sap-icon://activate"
                                        type="Ghost"
                                        press=".onProcessPress"
                                        visible="{= ${files>status} ? ${files>status}.toLowerCase() !== 'processed' &amp;&amp; ${files>status}.toLowerCase() !== 'analyzed' &amp;&amp; ${files>status}.toLowerCase() !== 'completed' &amp;&amp; ${files>status}.toLowerCase() !== 'processing' : true }"/>
                                </HBox>
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>
                </VBox>
            </ScrollContainer>
        </content>
    </Page>
</mvc:View>
