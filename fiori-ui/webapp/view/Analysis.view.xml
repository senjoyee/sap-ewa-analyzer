<mvc:View
  controllerName="ewa.analyzer.controller.Analysis"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns="sap.m">
  <Page id="analysisPage" title="{i18n>analysisTitle}">
    <content>
      <VBox class="sapUiSmallMargin">
        <!-- Selected file summary area -->
        <VBox>
          <Title text="Selected file" level="H4" />
          <ObjectHeader
            title="{analysis>/file/name}"
            number="{analysis>/file/customer_name}"
            numberUnit="{analysis>/file/system_id}">
            <attributes>
              <ObjectAttribute
                title="Report Date"
                text="{analysis>/file/analysis_date_display}" />
            </attributes>
            <statuses>
              <ObjectStatus
                text="{= ${analysis>/file/ai_analyzed} ? 'Analyzed' : (${analysis>/file/processed} ? 'Processed' : 'Not processed')}"
                state="{= ${analysis>/file/ai_analyzed} ? 'Success' : (${analysis>/file/processed} ? 'Information' : 'None')}" />
            </statuses>
          </ObjectHeader>
        </VBox>

        <!-- Main analysis layout: preview + KPIs -->
        <HBox class="sapUiSmallMarginTop" fitContainer="true" renderType="Bare">
          <VBox width="60%" class="sapUiSmallMarginEnd">
            <Title text="Report preview" level="H4" />
            <BusyIndicator
              class="sapUiSmallMarginTop"
              visible="{analysis>/loading}" />
            <MessageStrip
              class="sapUiSmallMarginTop"
              text="{analysis>/error}"
              type="Error"
              showIcon="true"
              visible="{= !!${analysis>/error}}" />
            <ScrollContainer
              class="sapUiSmallMarginTop"
              width="100%"
              height="25rem"
              vertical="true"
              horizontal="false">
              <content>
                <FormattedText htmlText="{analysis>/html}" />
              </content>
            </ScrollContainer>
          </VBox>
          <VBox width="40%" class="sapUiSmallMarginBegin">
            <Title text="KPIs (placeholder)" level="H4" />
            <Text text="This area will show key metrics, including capacity outlook and related KPIs." />
          </VBox>
        </HBox>

        <!-- Future chat area -->
        <VBox class="sapUiSmallMarginTop">
          <Title text="Chat (to be added later)" level="H4" />
          <Text text="This area will host the conversational assistant related to the selected analysis." />
        </VBox>
      </VBox>
    </content>
  </Page>
</mvc:View>
