<mvc:View
  controllerName="ewa.analyzer.controller.Analysis"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns="sap.m">
  <Page id="analysisPage" title="{i18n>analysisTitle}">
    <headerContent>
      <Button
        id="chatButton"
        text="Chat"
        icon="sap-icon://discussion-2"
        type="Transparent"
        press="onOpenChat" />
    </headerContent>
    <content>
      <VBox class="sapUiSmallMargin">
        <!-- Selected file summary area -->
        <VBox>
          <Title text="Selected file" level="H4" />
          <ObjectHeader
            title="{analysis>/file/name}"
            number="{analysis>/file/customer_name}"
            numberUnit="{analysis>/file/system_id}">
            <attributes>
              <ObjectAttribute
                title="Report Date"
                text="{analysis>/file/analysis_date_display}" />
            </attributes>
            <statuses>
              <ObjectStatus
                text="{= ${analysis>/file/ai_analyzed} ? 'Analyzed' : (${analysis>/file/processed} ? 'Processed' : 'Not processed')}"
                state="{= ${analysis>/file/ai_analyzed} ? 'Success' : (${analysis>/file/processed} ? 'Information' : 'None')}" />
            </statuses>
          </ObjectHeader>
        </VBox>

        <!-- Main analysis layout: single report preview section -->
        <VBox class="sapUiSmallMarginTop">
          <Title text="Report preview" level="H4" />
          <BusyIndicator
            class="sapUiSmallMarginTop"
            visible="{analysis>/loading}" />
          <MessageStrip
            class="sapUiSmallMarginTop"
            text="{analysis>/error}"
            type="Error"
            showIcon="true"
            visible="{= !!${analysis>/error}}" />
          <ScrollContainer
            class="sapUiSmallMarginTop"
            width="100%"
            height="35rem"
            vertical="true"
            horizontal="false">
            <content>
              <FormattedText htmlText="{analysis>/html}" />
            </content>
          </ScrollContainer>
        </VBox>

      </VBox>
    </content>
  </Page>
  <Dialog
    id="chatDialog"
    title="Chat (placeholder)"
    stretchOnPhone="true">
    <content>
      <VBox class="sapUiSmallMargin">
        <Text text="This pop-out window will host the conversational assistant related to the selected analysis in a future step." />
      </VBox>
    </content>
    <endButton>
      <Button text="Close" press="onCloseChat" />
    </endButton>
  </Dialog>
</mvc:View>
