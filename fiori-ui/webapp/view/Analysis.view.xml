<mvc:View
  controllerName="ewa.analyzer.controller.Analysis"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns="sap.m">
  <Page id="analysisPage" title="{i18n>analysisTitle}" showNavButton="true" navButtonPress="onNavBack">
    <headerContent>
      <Button
        id="chatButton"
        text="Chat"
        icon="sap-icon://discussion-2"
        type="Transparent"
        press="onOpenChat" />
    </headerContent>
    <content>
      <VBox class="sapUiSmallMargin">
        <!-- Main analysis layout: report preview only -->
        <VBox class="sapUiSmallMarginTop">
          <BusyIndicator
            class="sapUiSmallMarginTop"
            visible="{analysis>/loading}" />
          <MessageStrip
            class="sapUiSmallMarginTop"
            text="{analysis>/error}"
            type="Error"
            showIcon="true"
            visible="{= !!${analysis>/error}}" />
          <VBox
            id="analysisContent"
            class="sapUiSmallMarginTop" />
        </VBox>
      </VBox>
    </content>
  </Page>
  <Dialog
    id="chatDialog"
    title="Chat"
    stretchOnPhone="true">
    <content>
      <VBox class="sapUiSmallMargin">
        <BusyIndicator
          class="sapUiSmallMarginBottom"
          visible="{chat>/loading}" />
        <MessageStrip
          class="sapUiSmallMarginBottom"
          text="{chat>/error}"
          type="Error"
          showIcon="true"
          visible="{= !!${chat>/error}}" />
        <List
          id="chatMessages"
          items="{chat>/messages}">
          <CustomListItem>
            <HBox justifyContent="Begin" width="100%">
              <VBox
                width="100%"
                class="sapUiSmallMarginBottom"
                justifyContent="Begin"
                alignItems="Stretch">
                <Text
                  text="{chat>text}"
                  wrapping="true" />
              </VBox>
            </HBox>
          </CustomListItem>
        </List>
        <TextArea
          class="sapUiSmallMarginTop"
          value="{chat>/input}"
          rows="3"
          width="100%" />
      </VBox>
    </content>
    <beginButton>
      <Button text="Send" press="onChatSend" enabled="{= !${chat>/loading}}" />
    </beginButton>
    <endButton>
      <Button text="Close" press="onCloseChat" />
    </endButton>
  </Dialog>
</mvc:View>
