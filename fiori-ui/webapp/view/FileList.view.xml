<mvc:View
  controllerName="ewa.analyzer.controller.FileList"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns="sap.m"
  xmlns:unified="sap.ui.unified">
  <Page id="fileListPage" showHeader="false">
    <content>
      <VBox class="ewaFileListFrame ewaFileListContent">
        <Text class="sapUiSmallMarginBottom" text="Upload and manage EWA reports, then open their insights and analysis." />

        <Panel class="sapUiSmallMarginTop">
          <content>
            <VBox>
              <VBox class="ewaUploadArea">
                <Text class="ewaUploadTitle" text="Drag or drop a file" />
                <Text text="or use the button below to select from your computer." />
                <Button
                  id="uploadButton"
                  text="Upload"
                  type="Emphasized"
                  press="onUploadPress" />
              </VBox>

              <HBox
                class="ewaPillBar"
                alignItems="Center"
                justifyContent="SpaceBetween">
                <Button
                  id="processButton"
                  text="Process"
                  enabled="false"
                  press="onProcessPress"
                  class="ewaPillButton" />
                <Button
                  id="deleteButton"
                  text="Delete"
                  enabled="false"
                  press="onDeletePress"
                  class="ewaPillButton" />
              </HBox>

              <!-- Phase 2: basic data binding to backend /api/files -->
              <BusyIndicator
                class="sapUiSmallMarginTop"
                visible="{files>/loading}" />

              <MessageStrip
                class="sapUiSmallMarginTop"
                text="{files>/error}"
                type="Error"
                showIcon="true"
                visible="{files>/hasError}" />

              <!-- Empty state -->
              <VBox
                class="ewaEmptyState"
                visible="{= !${files>/loading} &amp;&amp; ${files>/files}.length === 0 &amp;&amp; !${files>/hasError}}">
                <IllustratedMessage
                  illustrationType="sapIllus-EmptyList"
                  title="No files uploaded yet"
                  description="Upload your first EWA report to get started with AI-powered analysis." />
              </VBox>

              <Table
                id="fileTable"
                class="sapUiSmallMarginTop"
                items="{files>/files}"
                visible="{= ${files>/files}.length > 0}"
                mode="MultiSelect"
                selectionChange="onSelectionChange">
                <columns>
                  <Column><Text text="File Name" /></Column>
                  <Column><Text text="Customer" /></Column>
                  <Column hAlign="Center"><Text text="Status" /></Column>
                  <Column demandPopin="true" minScreenWidth="Tablet"><Text text="Uploaded On" /></Column>
                  <Column demandPopin="true" minScreenWidth="Tablet"><Text text="Report Date" /></Column>
                  <Column hAlign="End"><Text text="Actions" /></Column>
                </columns>
                <items>
                  <ColumnListItem>
                    <cells>
                      <ObjectIdentifier title="{files>name}" />
                      <Text text="{files>customer_name}" />
                      <ObjectStatus
                        text="{= ${files>ai_analyzed} ? 'Analyzed' : (${files>processed} ? 'Processed' : 'Not processed')}"
                        state="{= ${files>ai_analyzed} ? 'Success' : (${files>processed} ? 'Information' : 'None')}" />
                      <Text text="{files>uploaded_on_display}" />
                      <Text text="{files>analysis_date_display}" />
                      <Button
                        text="View Analysis"
                        icon="sap-icon://inspect"
                        type="Transparent"
                        visible="{files>ai_analyzed}"
                        press="onViewAnalysisPress" />
                    </cells>
                  </ColumnListItem>
                </items>
              </Table>
            </VBox>
          </content>
        </Panel>
      </VBox>
    </content>
  </Page>

  <Dialog
    id="uploadDialog"
    title="Upload file"
    stretchOnPhone="true">
    <content>
      <VBox class="sapUiSmallMargin">
        <Text text="Select a PDF file and enter the customer name." />

        <Label
          class="sapUiSmallMarginTop"
          text="File" />
        <unified:FileUploader
          id="uploadFile"
          width="100%" />

        <Label
          class="sapUiSmallMarginTop"
          text="Customer" />
        <Input
          id="uploadCustomer"
          width="100%"
          value="{upload>/customer}" />

        <MessageStrip
          class="sapUiSmallMarginTop"
          text="{upload>/error}"
          type="Error"
          showIcon="true"
          visible="{= !!${upload>/error}}" />
      </VBox>
    </content>
    <beginButton>
      <Button
        text="Upload"
        type="Emphasized"
        press="onUploadDialogUpload" />
    </beginButton>
    <endButton>
      <Button
        text="Cancel"
        press="onUploadDialogCancel" />
    </endButton>
  </Dialog>

</mvc:View>
